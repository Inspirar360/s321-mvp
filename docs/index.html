<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sistema 3-2-1</title>

    <!-- Rutas relativas -->
    <link rel="manifest" href="manifest.json?v=5" />
    <meta name="theme-color" content="#0f172a" />
<link rel="icon" type="image/png" href="pwa-icons/icon-192.png">
<meta name="mobile-web-app-capable" content="yes">
    <!-- iOS -->
    <link rel="apple-touch-icon" sizes="192x192" href="pwa-icons/icon-192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="3-2-1" />

    <style>
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: #f8fafc; color: #0f172a; }
      .wrap { max-width: 560px; margin: 0 auto; padding: 16px; }
      .card { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 4px 16px rgba(0,0,0,.06); margin: 12px 0; }
      button { width: 100%; padding: 12px 16px; border: 0; border-radius: 10px; background: #0f172a; color: #fff; font-weight: 600; cursor: pointer; }
      input, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0; background: #fff; }
      label { display: block; font-weight: 600; margin-bottom: 6px; }
      .muted { color: #64748b; font-size: 14px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Sistema 3-2-1</h1>
      <p class="muted">MVP instalable. Define tu 1 cosa de bienestar, momentos y ritual, y guarda.</p>

      <div class="card">
        <label>1 cosa de bienestar</label>
        <input id="bienestar" placeholder="Ej: Salir a trotar" maxlength="50" />
      </div>

      <div class="card">
        <label>Definir momentos</label>
        <input id="momentos" placeholder="Ej: 7:00 AM después del café" />
      </div>

      <div class="card">
        <label>Definir ritual</label>
        <textarea id="ritual" rows="3" placeholder="Ej: ropa lista, 5 min movilidad, salir..."></textarea>
      </div>

      <div class="card">
        <button id="guardar">Guardar prioridades</button>
        <p id="status" class="muted" style="margin-top:8px;"></p>
      </div>

      <div class="card">
        <button id="generar">Generar tarjeta 3-2-1</button>
        <p class="muted">Abre la tarjeta y compártela o imprímela.</p>
      </div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);
      const KEY = 's321_mvp';

      function load() {
        try {
          const data = JSON.parse(localStorage.getItem(KEY) || '{}');
          $('bienestar').value = data.bienestar || '';
          $('momentos').value = data.momentos || '';
          $('ritual').value = data.ritual || '';
        } catch {}
      }

      $('guardar').onclick = () => {
        const data = {
          bienestar: $('bienestar').value.trim(),
          momentos: $('momentos').value.trim(),
          ritual: $('ritual').value.trim(),
          ts: Date.now()
        };
        localStorage.setItem(KEY, JSON.stringify(data));
        $('status').textContent = 'Guardado ✓';
        setTimeout(() => $('status').textContent = '', 1500);
      };

      $('generar').onclick = () => {
        const d = JSON.parse(localStorage.getItem(KEY) || '{}');
        const html = `
          <html><head><meta charset="utf-8"><title>Tarjeta 3-2-1</title>
          <style>
            body{font-family:system-ui,sans-serif;padding:24px;background:#f8fafc;color:#0f172a}
            .t{background:#fff;border-radius:16px;padding:24px;box-shadow:0 6px 24px rgba(0,0,0,.08);max-width:560px;margin:auto}
            h2{margin-top:0}
            .item{margin:12px 0}
            .lbl{color:#64748b;font-size:14px}
          </style></head>
          <body><div class="t">
            <h2>Tarjeta 3-2-1</h2>
            <div class="item"><div class="lbl">1 cosa de bienestar</div><div><strong>${d.bienestar || ''}</strong></div></div>
            <div class="item"><div class="lbl">Momentos</div><div>${d.momentos || ''}</div></div>
            <div class="item"><div class="lbl">Ritual</div><div>${(d.ritual || '').replace(/\\n/g,'<br>')}</div></div>
          </div></body></html>`;
        const w = window.open('', '_blank');
        w.document.write(html);
        w.document.close();
      };

      load();

      // Registro del Service Worker con ruta relativa
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js').catch(console.error);
        });
      }
    </script>
  </body>
</html>

